<template>
  <div class="pwa-install-instructions" v-if="showInstructions">
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon :icon="downloadOutline"></ion-icon>
          –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        </ion-card-title>
        <ion-card-subtitle>SmartGames PWA</ion-card-subtitle>
      </ion-card-header>
      
      <ion-card-content>
        <!-- iOS –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
        <div v-if="isIOS" class="install-steps">
          <h4>üì± –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ iPhone/iPad:</h4>
          <ol>
            <li>–û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –≤ <strong>Safari</strong></li>
            <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" <ion-icon :icon="shareOutline"></ion-icon></li>
            <li>–í—ã–±–µ—Ä–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω"</li>
            <li>–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ "SmartGames"</li>
            <li>–ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å"</li>
          </ol>
        </div>

        <!-- Android –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
        <div v-else-if="isAndroid" class="install-steps">
          <h4>ü§ñ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ Android:</h4>
          <ol>
            <li>–û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –≤ <strong>Chrome</strong></li>
            <li>–ù–∞–∂–º–∏—Ç–µ –º–µ–Ω—é (—Ç—Ä–∏ —Ç–æ—á–∫–∏) –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É</li>
            <li>–í—ã–±–µ—Ä–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω"</li>
            <li>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É</li>
          </ol>
        </div>

        <!-- Desktop –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
        <div v-else class="install-steps">
          <h4>üíª –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:</h4>
          <ol>
            <li>–û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –≤ <strong>Chrome/Edge</strong></li>
            <li>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ</li>
            <li>–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é ‚Üí "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"</li>
          </ol>
        </div>

        <div class="benefits">
          <h4>‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:</h4>
          <ion-list>
            <ion-item>
              <ion-icon :icon="checkmarkCircleOutline" color="success" slot="start"></ion-icon>
              <ion-label>–ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫</ion-label>
            </ion-item>
            <ion-item>
              <ion-icon :icon="checkmarkCircleOutline" color="success" slot="start"></ion-icon>
              <ion-label>–†–∞–±–æ—Ç–∞ –≤ –æ—Ñ–ª–∞–π–Ω</ion-label>
            </ion-item>
            <ion-item>
              <ion-icon :icon="checkmarkCircleOutline" color="success" slot="start"></ion-icon>
              <ion-label>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</ion-label>
            </ion-item>
            <ion-item>
              <ion-icon :icon="checkmarkCircleOutline" color="success" slot="start"></ion-icon>
              <ion-label>–ù–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</ion-label>
            </ion-item>
          </ion-list>
        </div>

        <div class="actions">
          <ion-button expand="block" @click="hideInstructions">
            <ion-icon :icon="closeOutline" slot="start"></ion-icon>
            –ü–æ–Ω—è—Ç–Ω–æ
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue';
import {
  IonCard,
  IonCardHeader,
  IonCardTitle,
  IonCardSubtitle,
  IonCardContent,
  IonIcon,
  IonList,
  IonItem,
  IonLabel,
  IonButton
} from '@ionic/vue';
import {
  downloadOutline,
  shareOutline,
  checkmarkCircleOutline,
  closeOutline
} from 'ionicons/icons';

const showInstructions = ref(false);

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
const isIOS = computed(() => {
  return /iPad|iPhone|iPod/.test(navigator.userAgent);
});

const isAndroid = computed(() => {
  return /Android/.test(navigator.userAgent);
});

// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
onMounted(() => {
  const hasSeenInstructions = localStorage.getItem('pwa-instructions-seen');
  const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
  
  if (!hasSeenInstructions && !isStandalone) {
    showInstructions.value = true;
  }
});

const hideInstructions = () => {
  showInstructions.value = false;
  localStorage.setItem('pwa-instructions-seen', 'true');
};
</script>

<style scoped>
.pwa-install-instructions {
  position: fixed;
  top: 20px;
  left: 20px;
  right: 20px;
  z-index: 1000;
  max-width: 400px;
  margin: 0 auto;
}

.install-steps {
  margin: 16px 0;
}

.install-steps h4 {
  color: var(--ion-color-primary);
  margin-bottom: 12px;
}

.install-steps ol {
  padding-left: 20px;
}

.install-steps li {
  margin-bottom: 8px;
  line-height: 1.4;
}

.benefits {
  margin: 20px 0;
}

.benefits h4 {
  color: var(--ion-color-primary);
  margin-bottom: 12px;
}

.benefits ion-item {
  --padding-start: 0;
  --min-height: 32px;
}

.actions {
  margin-top: 20px;
}
</style>
